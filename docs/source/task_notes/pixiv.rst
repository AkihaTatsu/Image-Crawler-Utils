Pixiv Tasks
===========

Pixiv-related Parsers can be imported from :mod:`image_crawler_utils.stations.pixiv`. Check out its documentation for more details.

Keyword Filter for Pixiv
~~~~~~~~~~~~~~~~~~~~~~~~

Pixiv uses the keyword filter :func:`image_crawler_utils.stations.pixiv.filter_keyword_pixiv`. It will check whether a standard syntax keyword string matches the tags of an image.

+ For example, "クオン(うたわれるもの) OR うたわれるもの" matches tags "クオン(うたわれるもの)", "ハクオロ", while "クオン(うたわれるもの) AND うたわれるもの" does not match.

To use it in Downloader is like:

.. code-block:: python

    from image_crawler_utils.stations.pixiv import filter_keyword_pixiv

    downloader = Downloader(
        image_info_filter=lambda info: filter_keyword_pixiv(info, "クオン(うたわれるもの) OR うたわれるもの")
    )

Get Pixiv Cookies
~~~~~~~~~~~~~~~~~

Please refer to the documentation of :func:`get_pixiv_cookies() <image_crawler_utils.stations.pixiv.get_pixiv_cookies>` for detailed information.

You can save Pixiv cookies for later use instead of calling this function every run.

Pixiv Tips
~~~~~~~~~~

+ The main station URL of Pixiv is: https://www.pixiv.net/

.. important::

    You must have an account to use Pixiv-related Parsers. It is compulsory to use cookies that contains your account information (manually getting them or using :func:`image_crawler_utils.stations.pixiv.get_pixiv_cookies`) in Parsers.

.. warning::

    Pixiv has a VERY STRICT restriction on crawling! If too many **429 error warning** appears, you should **STOP THE CRAWLER** at once in case your account become suspended!

.. seealso::

    `Pixiv's searching tutorial <https://www.pixiv.help/hc/en-us/articles/235646387-I-would-like-to-know-how-to-search-for-content-on-pixiv>`_
        Read this page before searching in Pixiv.

        It is recommended to use keywords in Japanese. Translations of tags to other languages are currently not supported.

About PixivKeywordParser
------------------------

For the meaning of parameters and attributes, check out the documentation of :class:`PixivKeywordParser <image_crawler_utils.stations.pixiv.PixivKeywordParser>`.

.. note::

    PixivKeywordParser uses the ``image_num`` parameter to restrict the number of artworks fetched from Pixiv. The artworks will be fetched according to the order in :class:`image_crawler_utils.stations.pixiv.PixivSearchSettings`.

    .. important::

        ``image_num`` only restricts the number of Pixiv artworks, and an artwork may contain multiple images.

If you want to set advanced searching options, check out the documentation of :class:`PixivSearchSettings <image_crawler_utils.stations.pixiv.PixivSearchSettings>`. It can be passed in to the ``pixiv_search_settings`` parameter.

Example Program of PixivKeywordParser
-------------------------------------

This example will download images with keyword / tag "クオン" and "うたわれるもの1000users入り" which are neither manga nor generated by AI into the "Pixiv" folder. After you logging in to Pixiv, the cookies will be saved at ``Pixiv_cookies.json`` for later use. ``quick_mode`` is set to :py:data:`True` in this example.

.. literalinclude:: ../../../examples/pixiv_keyword_example.py

About PixivUserParser
---------------------

For the meaning of parameters and attributes, check out the documentation of :class:`PixivUserParser <image_crawler_utils.stations.pixiv.PixivUserParser>`.

.. note::

    PixivUserParser uses the ``image_num`` parameter to restrict the number of artworks fetched from Pixiv. The artworks will be fetched from the newest to the oldest.

    .. important::

        ``image_num`` only restricts the number of Pixiv artworks, and an artwork may contain multiple images.

Example Program of PixivUserParser
----------------------------------

This example will download the newest 30 images from `Pixiv member ID 2175653 <https://www.pixiv.net/users/2175653>`_ into the "Pixiv_user_2175653" folder. After you logging in to Pixiv, the cookies will be saved at ``Pixiv_cookies.json`` for later use. ``quick_mode`` is set to :py:data:`False` (default) in this example.

.. literalinclude:: ../../../examples/pixiv_user_example.py

Example ImageInfo of Pixiv
--------------------------

This example image information (Pixiv ID 60066082) is from `this Pixiv page <https://www.pixiv.net/artworks/60066082>`_.

With ``quick_mode`` set to :py:data:`False`, its :class:`ImageInfo <image_crawler_utils.ImageInfo>` structure in JSON is like:

.. collapse:: CLICK HERE TO DISPLAY

    .. literalinclude:: ../JSONs/Pixiv 60066082_p0 full.json

---------

With ``quick_mode`` set to :py:data:`True`, its :class:`ImageInfo <image_crawler_utils.ImageInfo>` structure generated by :class:`PixivKeywordParser <image_crawler_utils.stations.pixiv.PixivKeywordParser>` in JSON is like:

.. collapse:: CLICK HERE TO DISPLAY

    .. literalinclude:: ../JSONs/Pixiv 60066082_p0 keyword_quick.json

---------

With ``quick_mode`` set to :py:data:`True`, its :class:`ImageInfo <image_crawler_utils.ImageInfo>` structure generated by :class:`PixivUserParser <image_crawler_utils.stations.pixiv.PixivUserParser>` in JSON is like:

.. collapse:: CLICK HERE TO DISPLAY

    .. literalinclude:: ../JSONs/Pixiv 60066082_p0 user_quick.json

---------
